# Auto-generated by Forge.
#
{{- range .RouteServers }}
# - Route server IP: {{ . }}
{{- end }}
!---- Cumulus Defaults ----
frr defaults datacenter
log syslog informational
no zebra nexthop kernel enable
!---- Rendered frr.conf ----
vrf default
{{- range .AccessVLANs}}
	{{- if .HostRoute }}
		ip route {{ .HostRoute }} vlan{{ .ID }}
	{{- end }}
{{- end }}
exit-vrf
router bgp {{ .ASN }} vrf default
bgp router-id {{ .LoopbackIP }}
bgp disable-ebgp-connected-route-check
bgp bestpath as-path multipath-relax
timers bgp 3 9
bgp deterministic-med
! Neighbors
{{- if .RouteServers }}
	neighbor ROUTE_SERVERS peer-group
	neighbor ROUTE_SERVERS ebgp-multihop 255
	neighbor ROUTE_SERVERS remote-as external
	neighbor ROUTE_SERVERS update-source lo
{{- end }}
{{- range .RouteServers }}
	neighbor {{ . }} peer-group ROUTE_SERVERS
{{- end }}
neighbor FORGE_UPLINK peer-group
neighbor FORGE_UPLINK remote-as external
neighbor FORGE_UPLINK timers 3 9
neighbor FORGE_UPLINK timers connect 10
neighbor FORGE_UPLINK advertisement-interval 0
no neighbor FORGE_UPLINK capability extended-nexthop
{{- range .Uplinks }}
	neighbor {{ . }} interface peer-group FORGE_UPLINK
{{- end }}
{{- if not .UseAdminNetwork }}
	neighbor TENANT peer-group
	neighbor TENANT remote-as external
	neighbor TENANT maximum-prefix 10
	neighbor TENANT timers 3 9
	neighbor TENANT timers connect 10
	neighbor TENANT advertisement-interval 0
	{{- range .AccessVLANs}}
        	{{- if .HostIP }}
                	neighbor {{ .HostIP }} peer-group TENANT
                	neighbor {{ .HostIP }} passive
        	{{- end }}
	{{- end }}
{{- end }}
! Address families
address-family ipv4 unicast
{{- if not .UseAdminNetwork }}
	neighbor TENANT route-map DPU_TO_INSTANCE out
{{- end }}
network {{ .LoopbackIP }}/32
{{- range .AccessVLANs }}
	{{- if .HostRoute }}
		network {{ .HostRoute }}
	{{- end }}
{{- end }}
maximum-paths ibgp 64
maximum-paths 64
distance bgp 20 200 200
neighbor FORGE_UPLINK activate
neighbor FORGE_UPLINK allowas-in
neighbor FORGE_UPLINK prefix-list FORGE_FROM_UNDERLAY in
neighbor FORGE_UPLINK route-map FORGE_TO_UNDERLAY out
{{- if not .UseAdminNetwork }}
	neighbor TENANT prefix-list DPU_FROM_INSTANCE in
{{- end }}
{{- if .RouteServers }}
	no neighbor ROUTE_SERVERS activate
{{- end }}
exit-address-family
address-family l2vpn evpn
advertise-all-vni
{{- if not .RouteServers }}
	neighbor FORGE_UPLINK activate
	neighbor FORGE_UPLINK allowas-in
{{- end }}
{{- if .RouteServers }}
	neighbor ROUTE_SERVERS activate
        neighbor ROUTE_SERVERS allowas-in
{{- end }}
exit-address-family
! end of router bgp {{ .ASN }} vrf default
ip prefix-list FORGE_FROM_UNDERLAY seq 10 permit 0.0.0.0/0
ip prefix-list FORGE_FROM_UNDERLAY seq 65535 deny any
{{- if not .UseAdminNetwork }}
	ip prefix-list DPU_FROM_INSTANCE seq 10 permit 0.0.0.0/0 ge 32
{{- end }}
{{- range .AccessVLANs}}
	route-map FORGE_TO_UNDERLAY deny {{ .ID }}
	match interface vlan{{ .ID }}
{{- end }}
route-map FORGE_TO_UNDERLAY permit 65535
{{- if not .UseAdminNetwork }}
	route-map DPU_TO_INSTANCE deny 10
{{- end }}
!---- CUE snippets ----
ip nht resolve-via-default

