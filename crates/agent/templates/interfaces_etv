# Auto-generated by Forge!
source /etc/network/interfaces.d/*.intf

auto lo
iface lo inet loopback
    address {{ .LoopbackIP }}/32
    vxlan-local-tunnelip {{ .LoopbackIP }}

{{- range .Uplinks}}

auto {{ . }}
iface {{ . }}
{{ end }}

{{- range .PortConfigs }}

auto {{ .Name }}
iface {{ .Name }}
    bridge-access {{ .VlanID }}

auto vlan{{ .VlanID }}
iface vlan{{ .VlanID }}
{{- if .IP }}
    address {{ .IP }}
{{- end }}
    vlan-raw-device br_default
    vlan-id {{ .VlanID }}
{{ end }}

{{- if .VNIDevice }}
auto {{ .VNIDevice }}
iface {{ .VNIDevice }}
    bridge-vlan-vni-map{{ range .PortConfigs }}{{ if gt .VNI 0}}  {{.VlanID}}={{.VNI}}{{end}}{{ end }}
    bridge-learning off
{{- end }}

auto br_default
iface br_default
    bridge-ports {{ range .PortConfigs }}{{ .Name }} {{ end }} {{ if .VNIDevice }} {{ .VNIDevice }} {{end}}
    bridge-vlan-aware yes
    bridge-vids {{ range .PortConfigs }} {{ if gt .VNI 0 }}{{ .VlanID }} {{ else }} 1 {{ end }} {{ end }}
    bridge-pvid 1
